{% extends 'base.html' %}

{% block content %}
<div class="max-w-screen-xl mx-auto p-6">
    {% include 'components/movie_detail_section.html' %}

    <div x-data="{ selectedSeats: [] }">
        {% for date, cinemas in grouped_showtimes.items() %}
        <h3 class="text-lg font-bold mt-4">{{ date }}</h3>

        {% for cinema, showtimes in cinemas.items() %}
        <h4 class="font-semibold mt-2">{{ cinema }}</h4>

        <div class="grid grid-cols-1 gap-4">
            {% for show in showtimes %}
            <div class="border p-4 rounded bg-gray-50">
                <p class="font-medium text-gray-700">
                    {{ show.date_time.strftime('%H:%M') }} – {{ show.available_seats }} ghế trống
                </p>

                <!-- Ghế để chọn -->
                <div class="grid grid-cols-10 gap-1 mt-2">
                    {% for ticket in show.tickets %}
                    <button
                    title="{{ ticket.status.value }}"
                    class="p-1 text-xs rounded 
                {% if ticket.status.value in ['paid', 'reserved', 'cancelled', 'used', 'expired'] %} 
                    bg-red-400 cursor-not-allowed 
                {% else %} 
                    bg-gray-200 hover:bg-green-300 
                {% endif %}" :class="selectedSeats.includes({{ ticket.id }}) ? 'bg-green-500 text-white' : ''"
                        @click.prevent="selectedSeats.includes({{ ticket.id }}) ? selectedSeats = selectedSeats.filter(id => id !== {{ ticket.id }}) : selectedSeats.push({{ ticket.id }})"
                        {% if ticket.status.value !='available' %} disabled {% endif %}>
                        {{ ticket.seat.row }}{{ ticket.seat.column }}
                    </button>
                    {% endfor %}
                </div>
            </div>
            {% endfor %}
        </div>
        {% endfor %}
        {% endfor %}

        <!-- Nút đặt vé -->
        <form method="POST" action="#">
            <input type="hidden" name="selected_tickets" :value="JSON.stringify(selectedSeats)">
            <button type="submit" class="mt-4 px-4 py-2 bg-blue-600 text-white rounded">Xác nhận đặt vé</button>
        </form>
    </div>
</div>
{% endblock %}


{# #}